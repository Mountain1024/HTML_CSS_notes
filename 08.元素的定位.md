# CSS 元素的定位

## 标准流(Normal Flow)

- **定义**：标准流是 CSS 的默认布局模式，元素按照 HTML 文档顺序从上到下、从左到右排列。
  - **块级元素**（如 `<div>`、`<p>`、`<h1>`）：独占一行，垂直堆叠，宽度默认撑满父容器。
  - **行内元素**（如 `<span>`、`<a>`、`<img>`）：水平排列，空间不足时自动换行，宽度由内容决定。
- 特点 ：
  - **位置依赖 HTML 结构**：无层叠，元素严格遵循文档流。
  - **间距调整**：通过 `margin`（支持负值）和 `padding` 控制。
    - 示例：`<div style="margin-top: -10px;">` 可让元素上移，与上方元素重叠。
- 局限性 ：
  - 修改某元素的 `margin` 或 `padding` 可能引发连锁反应，影响相邻元素。例如，给一个 `<div>` 设置 `margin-left: 50px`，可能挤压右侧元素。
  - 无法实现元素重叠、悬浮或固定等复杂效果。

> **提示**：若需跳出标准流并独立定位，可使用 `position` 属性。

## 定位（Positioning）

定位通过 `position` 属性改变元素的布局行为，使其脱离标准流或以特定方式定位。常见场景包括：

- 将元素叠放在其他元素之上（如弹窗）。
- 固定元素在视口内（如回到顶部按钮）。

![image-20231224164743622](./assets/image-20231224164743622.png)

### position 属性取值

- **`static`**：默认值，遵循标准流。
- **`relative`**：相对定位，基于自身原始位置偏移。
- **`absolute`**：绝对定位，脱离标准流，相对最近定位祖先。
- **`fixed`**：固定定位，脱离标准流，相对视口。
- **`sticky`**：粘性定位，滚动至阈值时切换为固定。

> #### 定位元素定义
>
> - **定位元素**：`position` 值不为 `static` 的元素（即 `relative`、`absolute`、`fixed`、`sticky`）。
> - **特点**：
>   - 可通过 `top`、`right`、`bottom`、`left` 精确控制位置。
>   - 默认宽高由内容决定，但可手动设置。
>   - 脱离标准流后，不再受块级/行内规则约束。
>   - 不向父元素反馈宽高信息。
>   - 内部子元素默认仍按标准流布局。

## 静态定位（Static） 

- 定义：
  - `position: static` 是所有元素的默认定位方式。
  - 元素严格遵循标准流布局。

- 特点 ：
  - `top`、`right`、`bottom`、`left` 属性无效。
  - 示例：`<div style="position: static; top: 10px;">` 的 `top: 10px` 不会生效。

## 相对定位（Relative） 

- **布局方式** ：元素仍然按照标准流进行布局，但可以通过 `top`、`right`、`bottom`、`left` 属性进行偏移。
- **参照对象** ：元素自身原来的位置。
- 应用场景 ：
  - 在不影响其他元素位置的前提下，对当前元素的位置进行微调。
  - 常用于调整元素的细微位置偏差。

![image-20231224165521909](./assets/image-20231224165521909.png)

## 固定定位（Fixed） 

- **布局方式** ：元素脱离标准流，成为脱标元素。
- **参照对象** ：视口（Viewport），即使页面滚动，元素仍固定在视口中的指定位置。
- 特点 ：
  - `top`、`right`、`bottom`、`left` 属性用于精确定位。
  - 适用于创建悬浮按钮、导航栏等需要固定显示的元素。

> - **视口（Viewport）** ：浏览器可视区域，如下图红框所示。
> - **画布（Canvas）** ：渲染文档的区域，文档内容超出视口时可以滚动查看，如下图黑框所示。
> - **宽高对比**：画布 >= 视口。 

![image-20231224170143383](./assets/image-20231224170143383.png)

## 绝对定位（Absolute） 

**定义：**元素脱离标准流，相对于最近的定位祖先元素（`position` 不为 `static`）定位，无定位祖先时参照视口

- **布局方式** ：元素脱离标准流，成为脱标元素。
- **参照对象** ：最近的已定位祖先元素（即 `position` 不为 `static` 的元素）。如果没有已定位的祖先元素，则参照对象为视口。
- 特点 ：
  - `top`、`right`、`bottom`、`left` 属性用于精确定位。
  - 常用于创建弹出框、工具提示等需要精确控制位置的元素。

### 子绝父相

- 在绝大数情况下, 子元素的绝对定位都是相对于父元素进行定位

- 如果不希望父元素脱离标准流，可以让父元素设置 `position: relative`，使其成为定位元素。

- 子元素设置 `position: absolute`，相对于父元素进行定位。

### 绝对定位元素的尺寸计算

- **宽度公式**：  

  ```plaintext
  定位参照对象的宽度 = left + right + margin-left + margin-right + 绝对定位元素的实际宽度
  ```

- **高度公式**：  

  ```plaintext
  定位参照对象的高度 = top + bottom + margin-top + margin-bottom + 绝对定位元素的实际高度
  ```

#### 特殊用法

1. **与参照对象一致**：  
   如果希望绝对定位元素的宽度和高度与参照对象一致，可以设置以下属性：  

   ```css
   position: absolute; left: 0; right: 0; top: 0; bottom: 0; margin: 0;
   ```

2. **居中显示**：  
   如果希望绝对定位元素在参照对象中居中显示，可以设置以下属性：  

   ```css
   position: absolute; left: 0; right: 0; top: 0; bottom: 0; margin: auto; width: 200px; height: 100px;
   ```

   同时需要指定具体的宽度和高度（宽高应小于参照对象的宽高）。

## 粘性定位（Sticky） 

- 定义：结合相对与固定定位，元素在滚动未达阈值时表现为相对定位，达到阈值后变为固定定位。

- 特点：
  - **参照对象**：最近的滚动容器（包括视口）。
  - **阈值设置**：使用 `top` 等属性定义切换点。
  - **应用场景**：吸顶导航。

- ```html
  <header style="position: sticky; top: 0; background: #f8f8f8; padding: 10px;">
    导航内容
  </header>
  <main style="height: 2000px;">页面内容...</main>
  ```

## position 值对比

| **定位类型**          | **描述**                                                     | **脱离标准流** | **定位元素** | **绝对定位元素** | **定位参照对象**                           | **`top`/`left` 属性** |
| --------------------- | ------------------------------------------------------------ | -------------- | ------------ | ---------------- | ------------------------------------------ | --------------------- |
| `static` - 静态定位   | 默认值，元素按照标准流进行布局                               | 否             | 否           | 否               | 无                                         | 无作用                |
| `relative` - 相对定位 | 元素相对于其原始位置进行偏移                                 | 否             | 是           | 否               | 元素自身原来的位置                         | 有作用                |
| `absolute` - 绝对定位 | 元素脱离标准流，按指定位置定位                               | 是             | 是           | 是               | 最邻近的定位祖先元素（如果没有则参照视口） | 有作用                |
| `fixed` - 固定定位    | 元素脱离标准流，按指定位置定位，参照对象为视口               | 是             | 是           | 是               | 视口                                       | 有作用                |
| `sticky` - 粘性定位   | 元素在滚动到某个阈值时表现为相对定位，达到阈值后变为固定定位 | 部分           | 是           | 是               | 最近的滚动祖先容器（包含视口）             | 有作用                |

## auto 到底是什么?

`800 = 200 + ml0 + mr0 + 0 + 0`

- `auto` 的含义是：**交由浏览器自动处理**

- `width:auto;`：
  1. **行内非替换元素**：`width` 包裹内容。
  
  2. **块级元素**：`width` 撑满包含块。
  3. **绝对定位**：`width` 包裹内容。

## `z-index` 层叠顺序

`z-index` 属性用于设置定位元素的层叠顺序（仅对已定位元素有效）。 

- **取值范围** ：正整数、负整数、0。
- 比较原则 ：
  1. 兄弟关系 ：
     - `z-index` 越大，层叠在越上面。
     - `z-index` 相等时，写在后面的元素层叠在上面。
  2. 非兄弟关系 ：
     - 分别从两个元素及其祖先元素中找出最临近的两个定位元素进行比较。
     - 这两个定位元素必须设置了具体的 `z-index` 数值。

![image-20231224172429240](./assets/image-20231224172429240.png)

## 定位常见问题与技巧

- **溢出处理**：定位元素超出父容器时，可用 `overflow: hidden` 或设父元素 `position: relative`。
- **兼容性**：`sticky` 在 IE 中不支持，可用 JS 或 `fixed` 替代。
- **层叠上下文**：`z-index` 受父元素影响，`transform`、`opacity` 等属性会创建新上下文。
- **与 Flex/Grid 结合**：
  - 定位元素（如 `absolute`）不影响 Flex/Grid 布局。
  - 用 `relative` 微调 Flex 子项，或 `absolute` 实现悬浮。
